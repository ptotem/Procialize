<%= content_for :page_title do %>
    New Message
<% end %>
<%= content_for :page_menu do %>

<% end %>

<%= content_for :head do %>
    <script type="text/javascript">
        $(function(){

            $('[type="submit"]').button('disable');
            $(function () {
                $('[type="submit"]').button('disable');
                $('select').change && $('#message_body').focus (function () {
                    if (($('select option:selected') && $('#message_body')).length > 0) {
                        $('[type="submit"]').button('enable');

                    } else {
                        $('[type="submit"]').button('disable');

                    }
                });

            });

            $('#message_body').blur(function () {
                if ($(this).val().length <= 0) {
                    $('[type="submit"]').button('disable');
                }
                else{
                    $('[type="submit"]').button('enable');
                }
            });

        }) ;


    </script>
<% end %>




<% if !params[:reply]  %>
<div data-role="collapsible" data-theme="a" data-collapsed="true" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inset="false" data-mini="true" data-filter="true">
  <h3 style="font-size: 0.8em;"><div  id="search_delegates" class="search_dele">Delegates</div></h3>
  <ul data-role="listview" data-theme="a" data-divider-theme="d"  data-split-icon='star' data-mini="true" data-filter="true">
    <% @users = User.all  %>
    <% @use = @users - [current_user]  %>

    <% User.all.each do |e| %>
        <li id="<%= e.id %>">
          <h3 style="font-size: 0.8em;" id="delegates_name"><%= e.name %></h3>
          <input type="checkbox" class="custom" style="height:2em;width:3em;"/>
        </li>
    <% end %>
  </ul>
</div>
 <% end %>


<%= form_for :message, :url=> {:action=> :create},:html => {:class => "meeting",:id => "message_form", :'data-ajax'=>"false"} do |f| %>

    <%= f.hidden_field :conference_id, :value => Conference.last.id %>
    <%= f.hidden_field :user_id, :value => current_user.id %>
    <% if @all %>
        <%#= select_tag 'receipient_users[]', options_for_select(@user_list, @receipients), :multiple => true,:"data-mini" => "true" %>
    <% else %>
        <%= select_tag 'receipient_users[]', options_for_select(@user_list, @receipient), :multiple => true,:"data-mini" => "true" %>
    <% end %>
     <br>
    <div class="field" style="font-size: 0.8em;">
      <%= f.text_area :body, :rows => '5', :placeholder => "Type in your message",:"data-mini" => "true",:style => "font-size:0.8em;" %>
    </div>
     <br>
    <div data-role="controlgroup" data-type="horizontal" style="float: right;">
      <a class="index_styling" href="#" data-ajax=false data-role="button" class="form_btn" id="form_btn_id" data-mini="true">Send</a>
      <%#= f.submit "Send", :'data-role' => "button",:"data-mini" => "true"%>
    </div>
<% end %>

<script type="text/javascript">

    $(function () {
        $('.custom').live('click',function () {
            var checked;
            if ($(this).is(':checked')) {
                checked = true;
                var adding = ($(this).parent().parent().attr('id'));
                var b=($(this).parent().parent().find('#delegates_name').text());
                $('#search_delegates').text().replace(/Delegates/,"");
                $('#search_delegates').html($('#search_delegates').text().replace(/Delegates/,"") + b + ", ");
                $('#message_form').append('<input id='+adding+' type="hidden" name="receipient_users[]" value='+adding+'>');
            }

            else {
                checked = false;
                var deleting = ($(this).parent().parent().attr('id'));
                var string = $(this).parent().parent().find('#delegates_name').text();
                var new_string = $('#search_delegates').text().replace(string+",", '');
                $('#search_delegates').text(new_string);
                $('#message_form').find('#'+deleting).empty().remove();
            }

        });


        $('#form_btn_id').click(function(){
             if ($('#message_body').val()==""){
            <%= add_gritter("Please fill Message", :title => "Error!",:image => :warning,:time => 2000  ) %>
            }
            else
            {

                $('#message_form').submit();
            }
        });

    });

</script>

